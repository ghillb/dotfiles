#!/usr/bin/env ansible-playbook

---
- name: Install packages
  connection: local
  hosts: localhost
  become: true
  become_method: sudo
  become_user: root
  gather_facts: false

  tasks:

    - name: Install pre-requisites via apt
      apt:
        pkg:
          - stow
          - git
          - software-properties-common
        update_cache: true
        state: present
      tags:
        - pre-requisites

    - name: Add neovim-ppa repository
      ansible.builtin.apt_repository:
        repo: ppa:neovim-ppa/unstable
        state: present
      tags:
        - terminal-utilities

    - name: Install terminal-utilities via apt
      apt:
        pkg:
          - curl
          - wget
          - rsync
          - inetutils-ping
          - neovim
          - tmux
          - htop
          - docker.io
          - docker-compose
          - podman
          - ripgrep
          - silversearcher-ag
          - visidata
          - sshfs
          - nnn
          - jq
          - bat
          - exa
          - gron
          - curl
          - shellcheck
          - dos2unix
          - bash-completion
          - ncdu
          - direnv
          - gcc
          - make
          - perl
          - python3-venv
          - python3-pip
          - python3-dev
          - sqlite3
          - libsqlite3-dev
          - pre-commit
          - yamllint
          - ansible-lint
          # - zoxide
        update_cache: true
        state: present
      tags:
        - terminal-utilities

    - name: Install desktop-utilities via apt
      apt:
        pkg:
          - spectrwm
          - fonts-firacode
          - ttf-ancient-fonts
          - picom
          - feh
          - xdotool
          - wmctrl
          - xsel
          - rofi
          - kitty
          - nnn
          - zathura
          - scrot
        update_cache: true
        state: present
      tags:
        - desktop-utilities

    - name: Install utilities via git
      become: false
      git:
        repo: "{{ item.repo }}"
        dest: "{{ item.dest }}"
        depth: 1
      loop:
        - repo: https://github.com/junegunn/fzf.git
          dest: ~/.fzf
      tags:
        - desktop-utilities
        - terminal-utilities

- name: Install (user) packages
  connection: local
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Get nvm install script
      get_url:
        url: https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.1/install.sh
        dest: /tmp/nvm.sh
        mode: 0777
      tags:
        - desktop-utilities
        - terminal-utilities

    - name: Install nvm
      command: bash /tmp/nvm.sh
      tags:
        - desktop-utilities
        - terminal-utilities

    - name: Install node
      shell: |
        . $HOME/.nvm/nvm.sh
        nvm install 16
      args:
        executable: /bin/bash
      tags:
        - desktop-utilities
        - terminal-utilities
